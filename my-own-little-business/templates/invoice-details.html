<html>
<head>
    <style>
        th, td { border-bottom : 1px solid black; }
    </style>
</head>
<body>
    <p>Bonjour {{ first_name }},</p>

    <p>Nous vous prions de bien trouver ci-dessous votre facture, à payer dans
    les meilleurs délais, s'il vous plait.</p>

    <p>Merci de joindre le numéro de facture à votre règlement.</p>

    <h3>Éléments de la facture</h3>

    <table>
        <tbody>
            <tr>
                <td><b>Numéro de facture</b></td>
                <td>{{ payment_id }}</td>
            </tr>
            <tr>
                <td><b>Montant</b></td>
                <td>{{ total }} €</td>
            </tr>
            <tr>
                <td><b>Date</b></td>
                <td>{{ invoice_date.strftime("%d-%m-%Y") }}</td>
            </tr>
        </tbody>
    </table>

    <h3>Récapitulatif de la facture par fournée</h3>

    {% for batch_date, batch_date_group in payment_details|groupby("batch_date") -%}
    {% for order_total, group_list in batch_date_group|groupby("order_total") -%}
    <h4>Fournée du {{ batch_date.strftime("%d-%m-%Y à %H:%M") }}</h4>

    <p>Montant de la commande : {{ order_total }} €</p>

    <table>
        <thead>
            <th>Nom du produit</th>
            <th>Quantité</th>
        </thead>
        <tbody>
            {% for line in group_list -%}
            <tr>
                <td>{{ line.product_name }}</td>
                <td>{{ line.quantity }}</td>
            </tr>
            {%- endfor %}
        </tbody>
    </table>

    {%- endfor %}
    {%- endfor %}

    <p>Nous vous remercions de votre confiance et espérons vous revoir
    prochainement.</p>
</body>
</html>
